<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>RPA_invoice</name>
        <label>RPA invoice</label>
        <locationX>615</locationX>
        <locationY>333</locationY>
        <actionName>SendSlackMessageToOperations</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Get_Map</targetReference>
        </connector>
        <inputParameters>
            <name>Message</name>
            <value>
                <elementReference>NOASignedbody</elementReference>
            </value>
        </inputParameters>
    </actionCalls>
    <apiVersion>49.0</apiVersion>
    <decisions>
        <name>Status_of_RPA_Docusign</name>
        <label>Status of RPA  Docusign</label>
        <locationX>245</locationX>
        <locationY>210</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Docusign_Sent</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>DocusignStatus.dsfs__Envelope_Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Sent</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>RPA_Sent</targetReference>
            </connector>
            <label>Docusign Sent</label>
        </rules>
        <rules>
            <name>Docusign_Completed</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>DocusignStatus.dsfs__Envelope_Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Completed</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>RPA_Signed</targetReference>
            </connector>
            <label>Docusign  Completed</label>
        </rules>
    </decisions>
    <description>Added the ARPA Signed for Map added the date of Singnature of ARPA in the Map . Added exclusion for Map passtrough ,</description>
    <interviewLabel>Docusign send via Account {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Docusign Subflow send via Account</label>
    <loops>
        <description>Loop map for each supplier</description>
        <name>Loop_Map</name>
        <label>Loop Map</label>
        <locationX>815</locationX>
        <locationY>23</locationY>
        <assignNextValueToReference>SupplierBuyerMapSigned</assignNextValueToReference>
        <collectionReference>Get_Map</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Update_Overdue_additional_Discount_Rate_map</targetReference>
        </nextValueConnector>
    </loops>
    <loops>
        <description>Loop map for each supplier</description>
        <name>Loop_Map_0</name>
        <label>Loop Map</label>
        <locationX>408</locationX>
        <locationY>443</locationY>
        <assignNextValueToReference>SupplierBuyerMapSent</assignNextValueToReference>
        <collectionReference>Get_Map_Sent</collectionReference>
        <iterationOrder>Asc</iterationOrder>
        <nextValueConnector>
            <targetReference>Update_Overdue_additional_Discount_Rate_map_0</targetReference>
        </nextValueConnector>
    </loops>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordLookups>
        <name>Get_account</name>
        <label>Get account</label>
        <locationX>417</locationX>
        <locationY>16</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Status_of_RPA_Docusign</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>DocusignStatus.dsfs__Company__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Account</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>RPA_Sent__c</queriedFields>
        <queriedFields>RPA_Signed__c</queriedFields>
        <queriedFields>Account_Name__c</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_DocuSign_Status</name>
        <label>Get DocuSign Status</label>
        <locationX>228</locationX>
        <locationY>18</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_account</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>DocusignStatusID</elementReference>
            </value>
        </filters>
        <object>dsfs__DocuSign_Status__c</object>
        <outputReference>DocusignStatus</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>dsfs__Company__c</queriedFields>
        <queriedFields>dsfs__Envelope_Status__c</queriedFields>
        <queriedFields>Invoice_Finance_Deal__c</queriedFields>
        <queriedFields>Supplier_Buyer_Map__c</queriedFields>
        <queriedFields>OwnerId</queriedFields>
        <queriedFields>dsfs__Subject__c</queriedFields>
        <queriedFields>dsfs__Sent_Date_Time__c</queriedFields>
        <queriedFields>dsfs__Completed_Date_Time__c</queriedFields>
        <queriedFields>Invoice_Finance_Deal2__c</queriedFields>
        <queriedFields>SUPPLIER_BUYER_MAP2__c</queriedFields>
        <queriedFields>Account_2__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_Map</name>
        <label>Get Map</label>
        <locationX>578</locationX>
        <locationY>13</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_Map</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Supplier__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Get_account.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Passthrough_Map__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Supplier_Buyer_Map__c</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>Overdue_Additional_Discount_rate__c</queriedFields>
        <queriedFields>ARPA_Amendment_Signed__c</queriedFields>
        <queriedFields>Date_Overdue_New_Pricing_Applicable__c</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Map_Sent</name>
        <label>Get Map Sent</label>
        <locationX>234</locationX>
        <locationY>443</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Loop_Map_0</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Supplier__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Get_account.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Passthrough_Map__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Supplier_Buyer_Map__c</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>Overdue_Additional_Discount_rate__c</queriedFields>
        <queriedFields>ARPA_Amendment_Signed__c</queriedFields>
        <queriedFields>Date_Overdue_New_Pricing_Applicable__c</queriedFields>
        <queriedFields>ARPA_Amendment_Sent__c</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>RPA_Sent</name>
        <label>RPA Sent</label>
        <locationX>57</locationX>
        <locationY>444</locationY>
        <connector>
            <targetReference>Get_Map_Sent</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Get_account.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>RPA_Sent__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <object>Account</object>
    </recordUpdates>
    <recordUpdates>
        <name>RPA_Signed</name>
        <label>RPA Signed</label>
        <locationX>447</locationX>
        <locationY>337</locationY>
        <connector>
            <targetReference>RPA_invoice</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Get_account.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>RPA_Signed__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <object>Account</object>
    </recordUpdates>
    <recordUpdates>
        <description>Update the additionnal discount rate on the map</description>
        <name>Update_Overdue_additional_Discount_Rate_map</name>
        <label>Update Overdue additional Discount Rate map</label>
        <locationX>1141</locationX>
        <locationY>23</locationY>
        <connector>
            <targetReference>Loop_Map</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>SupplierBuyerMapSigned.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>ARPA_Amendment_Signed__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Date_Overdue_New_Pricing_Applicable__c</field>
            <value>
                <elementReference>DocusignStatus.dsfs__Completed_Date_Time__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Overdue_Additional_Discount_rate__c</field>
            <value>
                <numberValue>0.5</numberValue>
            </value>
        </inputAssignments>
        <object>Supplier_Buyer_Map__c</object>
    </recordUpdates>
    <recordUpdates>
        <description>Update the additionnal discount rate on the map</description>
        <name>Update_Overdue_additional_Discount_Rate_map_0</name>
        <label>Update Overdue additional Discount Rate map</label>
        <locationX>859</locationX>
        <locationY>443</locationY>
        <connector>
            <targetReference>Loop_Map_0</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>SupplierBuyerMapSent.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>ARPA_Amendment_Sent__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <object>Supplier_Buyer_Map__c</object>
    </recordUpdates>
    <start>
        <locationX>46</locationX>
        <locationY>14</locationY>
        <connector>
            <targetReference>Get_DocuSign_Status</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <textTemplates>
        <name>BNLSignedbody</name>
        <isViewedAsPlainText>false</isViewedAsPlainText>
        <text>&lt;p&gt;The DocuSign {!DocusignStatus.dsfs__Subject__c} for the Map {!SupplierBuyerMapSigned.Name} is Completed&lt;/p&gt;</text>
    </textTemplates>
    <textTemplates>
        <name>BNLSignedTtile</name>
        <isViewedAsPlainText>false</isViewedAsPlainText>
        <text>&lt;p&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;Map  Number : {!SupplierBuyerMapSigned.Name}, BNL Signed&lt;/span&gt;&lt;/p&gt;</text>
    </textTemplates>
    <textTemplates>
        <name>NOASignedbody</name>
        <isViewedAsPlainText>false</isViewedAsPlainText>
        <text>RPA for new Pricing  : {!DocusignStatus.dsfs__Subject__c} for the account {!Get_account.Account_Name__c} is Completed</text>
    </textTemplates>
    <textTemplates>
        <name>NOASignedTitle</name>
        <isViewedAsPlainText>false</isViewedAsPlainText>
        <text>&lt;p&gt;Account : {!Get_account.Name}, RPA Signed&lt;/p&gt;</text>
    </textTemplates>
    <textTemplates>
        <name>OfferSignedBody</name>
        <isViewedAsPlainText>false</isViewedAsPlainText>
        <text>&lt;p&gt;Dear operation Team ,&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;the offer for the Map {!SupplierBuyerMapSigned.Name}  is Signed please proceed to the next Step.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Incomlend&lt;/p&gt;</text>
    </textTemplates>
    <textTemplates>
        <name>OfferSignedTitle</name>
        <isViewedAsPlainText>false</isViewedAsPlainText>
        <text>&lt;p&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;Invoice Number : {!invoice.Name}, Offer Signed&lt;/span&gt;&lt;/p&gt;</text>
    </textTemplates>
    <textTemplates>
        <name>RPASignedbody</name>
        <isViewedAsPlainText>false</isViewedAsPlainText>
        <text>&lt;p&gt;Dear operation Team ,&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;the RPAL for the Map {!SupplierBuyerMapSigned.Name}  is Signed please proceed to the next Step.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Incomlend&lt;/p&gt;</text>
    </textTemplates>
    <textTemplates>
        <name>RPASignedTitle</name>
        <isViewedAsPlainText>false</isViewedAsPlainText>
        <text>&lt;p&gt;&lt;span style=&quot;background-color: rgb(255, 255, 255);&quot;&gt;Invoice Number : {!invoice.Name}, RPA Signed&lt;/span&gt;&lt;/p&gt;</text>
    </textTemplates>
    <textTemplates>
        <name>test</name>
        <isViewedAsPlainText>false</isViewedAsPlainText>
        <text>&lt;p&gt;&amp;lt;p&amp;gt;test2&amp;lt;p&amp;gt;&lt;/p&gt;</text>
    </textTemplates>
    <variables>
        <name>DocusignID</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>dsfs__DocuSign_Status__ChangeEvent</objectType>
    </variables>
    <variables>
        <name>DocusignStatus</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>dsfs__DocuSign_Status__c</objectType>
    </variables>
    <variables>
        <name>DocusignStatusID</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <name>invoice</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>invoice_finance_deal__c</objectType>
    </variables>
    <variables>
        <name>OwnerAccount</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>User</objectType>
    </variables>
    <variables>
        <name>OwnerName</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue>:warning: Ops Owner is not set, please amend the Supplier Buyer Map :warning:</stringValue>
        </value>
    </variables>
    <variables>
        <name>SupplierBuyerMapSent</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Supplier_Buyer_Map__c</objectType>
    </variables>
    <variables>
        <name>SupplierBuyerMapSigned</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Supplier_Buyer_Map__c</objectType>
    </variables>
</Flow>
